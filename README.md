# Описание проекта

Данный проект реализует модель **локального сетевого чата** в конфигурации **«Независимые процессы, Один к одному»** в среде Linux. Проект демонстрирует использование различных механизмов **межпроцессного взаимодействия (IPC)** для организации двусторонней связи между процессами-участниками.

  * **Host** (Сервер): Является инициатором (создает IPC-ресурсы), ожидает подключения клиента с помощью **сигнала `SIGUSR1`** и следит за его активностью (таймаут 1 минута).
  * **Client** (Клиент): Подключается к Host по его PID, отправляя сигнал знакомства.

Взаимодействие между Host и Client реализовано с соблюдением требований к синхронизации (**Глобальные семафоры**) и таймаутам (5 секунд на операцию, 60 секунд на бездействие).

-----

# Сборка проекта

Проект использует `CMake` для автоматической сборки исполняемых файлов для каждого типа IPC.

## Команды для сборки

1.  Убедитесь, что установлен `CMake` и компилятор `g++` (с поддержкой C++17).
     ```
     sudo apt install cmake g++
     ```

2.  Выполните скрипт сборки в корневой папке проекта:

    ```bash
    chmod +x build.sh
    ./build.sh
    ```

## Результат сборки

В директории `build/` будут созданы пары исполняемых файлов для трех реализованных типов IPC (Shared Memory - **seg**, Message Queue - **mq**, Named Pipe - **fifo**):

| Тип IPC | Файл Хоста (Server) | Файл Клиента (Client) |
| :--- | :--- | :--- |
| **Shared Memory (System V)** | `host_seg` | `client_seg` |
| **Message Queue (POSIX)** | `host_mq` | `client_mq` |
| **Named Pipe (FIFO)** | `host_fifo` | `client_fifo` |

-----

# Запуск и тестирование

Для каждого типа IPC требуется запустить два отдельных процесса в разных терминалах. Все команды выполняются из директории `build/`.

## 1\. Запуск Хоста и Ожидание

Запустите Хост, и он выведет свой PID, необходимый для подключения Клиента.

**Пример для Shared Memory (SEG):**

```bash
cd build/
./host_seg
```

> **Вывод Хоста:**
> `[13:00:00] [HOST] Started. PID: 12345`
> `[13:00:00] [HOST] Waiting for client signal (SIGUSR1)...`

## 2\. Подключение Клиента

Запустите Клиента, передав в качестве аргумента PID Хоста (`12345` в примере выше). Клиент отправит сигнал `SIGUSR1` для инициации соединения.

```bash
cd build/
./client_seg 12345
```

> **Вывод Хоста:**
> `[13:00:01] [HOST] Client connected! PID: 54321`
> `[13:00:01] [HOST] Chat started. Type messages.`

-----

# Проверка логики чата

## 1\. Тестирование Общих и Личных сообщений

Протокол поддерживает два типа сообщений, демонстрируя возможность передачи метаинформации через IPC.

| Тип сообщения | Команда ввода | Ожидаемый результат (на обеих сторонах) |
| :--- | :--- | :--- |
| **Общее** | `Привет всем!` | **Отображается:** `[Partner] Привет всем!` |
| **Личное** | `@private Это секрет` | **Отображается:** `[Partner [PRIVATE]] Это секрет` |

## 2\. Тестирование Корректного Завершения (Graceful Shutdown)

Для корректного выхода из программы и освобождения ресурсов IPC используйте команду `/quit` или `/exit`.

| Участник | Команда ввода | Действие |
| :--- | :--- | :--- |
| **Host** | `/quit` | Хост отправляет `MSG_DISCONNECT`, удаляет все IPC-ресурсы, завершается. Клиент получает сигнал и завершается. |
| **Client** | `/quit` | Клиент отправляет `MSG_DISCONNECT`, завершается. Хост получает сигнал и удаляет оставшиеся IPC-ресурсы. |

## 3\. Тестирование Таймаута Неактивности (Client)

Это требование проверяется автоматически, если Клиент бездействует.

| Участник | Действие | Ожидаемый результат |
| :--- | :--- | :--- |
| **Client** | Не отправляет сообщения **более 60 секунд** | Хост выводит сообщение: `[HOST] Client inactivity timeout (>1 min). Killing client.`, и принудительно завершает процесс Клиента с помощью `SIGKILL`. |

-----

# Повторное тестирование с другими IPC

Для проверки работы других механизмов IPC просто замените суффикс исполняемых файлов:

| Тип IPC | Запуск Host | Запуск Client |
| :--- | :--- | :--- |
| **Message Queue** | `./host_mq` | `./client_mq <PID>` |
| **Named Pipe** | `./host_fifo` | `./client_fifo <PID>` |
